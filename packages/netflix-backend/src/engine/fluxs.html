<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Flux Océan - Ondes/Particules</title>
<style>
  body { margin:0; overflow:hidden; background:#111; color:#fff; font-family:sans-serif; }
  #trace { position:absolute; bottom:0; right:0; width:300px; height:200px; background:rgba(0,0,0,0.7); overflow:auto; padding:5px; font-size:12px; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="trace"><b>Traces:</b><br></div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;

window.addEventListener('resize', () => { w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight; });

// Flux (océan)
let particles = [];
let transformers = [
    {x: w*0.5, y: h*0.3, r:40, name:'Transformer 1'},
    {x: w*0.7, y: h*0.6, r:50, name:'Transformer 2'}
];

// Ajouter perturbation
canvas.addEventListener('click', e => {
    particles.push({x:e.clientX, y:e.clientY, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, age:0});
    addTrace(`Perturbation à (${e.clientX},${e.clientY})`);
});

// Traces
function addTrace(msg){
    const traceDiv = document.getElementById('trace');
    traceDiv.innerHTML += msg+'<br>';
    traceDiv.scrollTop = traceDiv.scrollHeight;
}

// Boucle animation
function animate(){
    ctx.fillStyle = 'rgba(17,17,17,0.2)'; // fond avec traînée
    ctx.fillRect(0,0,w,h);

    // Dessiner transformers
    transformers.forEach(t => {
        ctx.beginPath();
        ctx.arc(t.x,t.y,t.r,0,Math.PI*2);
        ctx.fillStyle='rgba(0,150,255,0.3)';
        ctx.fill();
        ctx.strokeStyle='#0ff';
        ctx.stroke();
        ctx.fillStyle='#fff';
        ctx.fillText(t.name, t.x-30, t.y);
    });

    // Mettre à jour particules (flux)
    particles.forEach((p,i)=>{
        p.x += p.vx;
        p.y += p.vy;
        p.age += 1;

        // Vérifier collision avec transformer -> échantillonnage / particule
        transformers.forEach(t=>{
            let dx=p.x-t.x, dy=p.y-t.y;
            if(Math.sqrt(dx*dx+dy*dy)<t.r){
                addTrace(`Échantillonnage à ${t.name}`);
                p.vx*=-0.5; p.vy*=-0.5; // rebond avec perte d'énergie
            }
        });

        // Dessiner particule
        ctx.beginPath();
        ctx.arc(p.x,p.y,4,0,Math.PI*2);
        ctx.fillStyle='yellow';
        ctx.fill();

        // Supprimer si trop vieille
        if(p.age>300) particles.splice(i,1);
    });

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
